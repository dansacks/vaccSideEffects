
  ___  ____  ____  ____  ____ ®
 /__    /   ____/   /   ____/      StataNow 19.5
___/   /   /___/   /   /___/       SE—Standard Edition

 Statistics and Data Science       Copyright 1985-2025 StataCorp LLC
                                   StataCorp
                                   4905 Lakeway Drive
                                   College Station, Texas 77845 USA
                                   800-782-8272        https://www.stata.com
                                   979-696-4600        service@stata.com

Stata license: Unlimited-user network, expiring 23 Oct 2026
Serial number: 401909300710
  Licensed to: Daniel Sacks
               

Notes:
      1. Stata is running in batch mode.
      2. Unicode is supported; see help unicode_advice.
      3. Maximum number of variables is set to 5,000 but can be increased;
          see help set_maxvar.

. do /Users/sacks/Projects/VaccSideEffects/code/clean_prolific_demographics.do 

. /*===========================================================================
> ===
>     Clean Prolific Demographic Exports
> 
>     Input:  raw_data/prolific_demographic_export_*.csv
>     Output: derived/prolific_demographics_prescreen.dta
>             derived/prolific_demographics_main.dta
>             derived/prolific_demographics_main_morepay.dta
>             derived/prolific_demographics_followup.dta
> 
>     Cleans prolific demographic data for merging with survey data.
> 
>     Created by Dan + Claude Code
> =============================================================================
> =*/
. 
. clear all

. global scriptname "clean_prolific_demographics"

. do "code/_config.do"

. /*===========================================================================
> ===
>     Project Configuration
> 
>     Set the project directory once here; all other scripts include this file.
> 
>     Usage: Include at the top of each do-file:
>         global scriptname "my_script"
>         do "code/_config.do"
> 
>     In batch mode (stata -e), logs to output/logs/{scriptname}.log
>     In interactive mode, no logging occurs.
> 
>     Created by Dan + Claude Code
> =============================================================================
> =*/
. 
. * Settings for both batch and interactive mode
. set more off

. set rmsg off

. 
. * Set project directory based on operating system
. * c(os) returns "Windows" on Windows, "Unix" or "MacOSX" on Mac
. local usr `c(username)'

. if "`c(os)'" == "Windows" {
.     global projdir "C:/Users/`usr'/Projects/VaccSideEffects"
. }

. else {
.     * macOS (Unix or MacOSX)
.     global projdir "/Users/`usr'/Projects/VaccSideEffects"
. }

. cd "$projdir"
/Users/sacks/Projects/VaccSideEffects

. 
. * Add local ado files to path (for plot_to_csv and other custom programs)
. adopath + "$projdir/code/include"
  [1]  (BASE)      "/Applications/StataNow/ado/base/"
  [2]  (SITE)      "/Applications/StataNow/ado/site/"
  [3]              "."
  [4]  (PERSONAL)  "/Users/sacks/Documents/Stata/ado/personal/"
  [5]  (PLUS)      "/Users/sacks/Library/Application Support/Stata/ado/plus/"
  [6]  (OLDPLACE)  "~/ado/"
  [7]              "/Users/sacks/Projects/VaccSideEffects/code/include"

. adopath + "$projdir/code/ado"
  [1]  (BASE)      "/Applications/StataNow/ado/base/"
  [2]  (SITE)      "/Applications/StataNow/ado/site/"
  [3]              "."
  [4]  (PERSONAL)  "/Users/sacks/Documents/Stata/ado/personal/"
  [5]  (PLUS)      "/Users/sacks/Library/Application Support/Stata/ado/plus/"
  [6]  (OLDPLACE)  "~/ado/"
  [7]              "/Users/sacks/Projects/VaccSideEffects/code/include"
  [8]              "/Users/sacks/Projects/VaccSideEffects/code/ado"

. 
. * Create output subdirectories if they don't exist
. capture mkdir "output"

. capture mkdir "output/logs"

. capture mkdir "output/tables"

. capture mkdir "output/docs"

. capture mkdir "output/figures"

. 
. /*---------------------------------------------------------------------------
> ---
>     Named Constants
> 
>     These replace magic numbers scattered throughout the codebase.
> -----------------------------------------------------------------------------
> -*/
. 
. * Attention check expected values (from survey design)
. global ATTN_CHECK_PRESCREEN = 1965

. global ATTN_CHECK_MAIN = 4419

. global ATTN_CHECK_FOLLOWUP = 1163

. 
. * Special code for unselected responses
. global UNSELECTED_VALUE  = -99

. 
. * Special code for "prefer not to say" responses (same as unselected)
. global PREF_NOT_SAY = -99

. 
. /*---------------------------------------------------------------------------
> ---
>     Conditional Logging
> -----------------------------------------------------------------------------
> -*/
. 
. * Only log in batch mode
. if "`c(mode)'" == "batch" & "$scriptname" != "" {
.     capture log close _all
.     log using "output/logs/$scriptname.log", replace text
-------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/sacks/Projects/VaccSideEffects/output/logs/clean_prolific_d
> emographics.log
  log type:  text
 opened on:  16 Feb 2026, 20:51:49
.     di "=== Running in batch mode: $scriptname ==="
=== Running in batch mode: clean_prolific_demographics ===
.     di "Log: output/logs/$scriptname.log"
Log: output/logs/clean_prolific_demographics.log
.     di ""

. }

. 
end of do-file

. 
. /*---------------------------------------------------------------------------
> ---
>     Program to clean a single prolific demographic file
> -----------------------------------------------------------------------------
> -*/
. 
. capture program drop clean_prolific

. program define clean_prolific
  1.     args infile outfile
  2. 
.     di ""
  3.     di "=== Cleaning: `infile' ==="
  4. 
.     * Import CSV
.     use "`infile'", clear 
  5. 
.     * Rename key variables
.     rename status prolific_status
  6.     rename startedat prolific_started
  7.     rename completedat prolific_completed
  8.     rename timetaken prolific_duration
  9.     rename totalapprovals prolific_approvals
 10. 
.     * Clean demographics
.     rename age prolific_age
 11.     rename sex prolific_sex
 12.     rename ethnicitysimplified prolific_ethnicity
 13.     rename countryofbirth prolific_country_birth
 14.     rename countryofresidence prolific_country_residence
 15.     rename nationality prolific_nationality
 16.     rename language prolific_language
 17.     rename studentstatus prolific_student
 18.     rename employmentstatus prolific_employment
 19. 
.     * Convert numeric variables
.     destring prolific_age, replace force
 20.     destring prolific_duration, replace force
 21.     destring prolific_approvals, replace force
 22. 
.     * Clean string variables - handle DATA_EXPIRED
.     foreach var in prolific_student prolific_employment {
 23.         replace `var' = "" if `var' == "DATA_EXPIRED"
 24.     }
 25. 
.     * Create numeric codes for categorical variables
. 
.     * Sex
.     gen prolific_female = (prolific_sex == "Female") if prolific_sex != ""
 26.     gen prolific_male = (prolific_sex == "Male") if prolific_sex != ""
 27.     label var prolific_female "Female (Prolific)"
 28.     label var prolific_male "Male (Prolific)"
 29. 
.     * Ethnicity
.     encode prolific_ethnicity, gen(prolific_ethnicity_n)
 30.     label var prolific_ethnicity_n "Ethnicity (Prolific, numeric)"
 31. 
.     * Student status
.     gen prolific_is_student = (prolific_student == "Yes") if prolific_student
>  != ""
 32.     label var prolific_is_student "Currently a student (Prolific)"
 33. 
.     * Employment - create categories
.     gen prolific_employed_ft = strpos(prolific_employment, "Full-Time") > 0 i
> f prolific_employment != ""
 34.     gen prolific_employed_pt = strpos(prolific_employment, "Part-Time") > 
> 0 if prolific_employment != ""
 35.     gen prolific_not_working = strpos(prolific_employment, "Not in paid wo
> rk") > 0 if prolific_employment != ""
 36.     gen prolific_unemployed = strpos(prolific_employment, "Unemployed") > 
> 0 if prolific_employment != ""
 37.     label var prolific_employed_ft "Employed full-time (Prolific)"
 38.     label var prolific_employed_pt "Employed part-time (Prolific)"
 39.     label var prolific_not_working "Not in paid work (Prolific)"
 40.     label var prolific_unemployed "Unemployed (Prolific)"
 41. 
.     * Keep only relevant variables
.     keep study_id prolific_status ///
>          prolific_started prolific_completed prolific_duration prolific_appro
> vals ///
>          prolific_age prolific_sex prolific_female prolific_male ///
>          prolific_ethnicity prolific_ethnicity_n ///
>          prolific_country_birth prolific_country_residence prolific_nationali
> ty ///
>          prolific_language prolific_student prolific_is_student ///
>          prolific_employment prolific_employed_ft prolific_employed_pt ///
>          prolific_not_working prolific_unemployed
 42. 
.     * Label core variables
.     label var study_id "Cross-wave participant ID"
 43.     label var prolific_status "Prolific submission status"
 44.     label var prolific_started "Prolific start time"
 45.     label var prolific_completed "Prolific completion time"
 46.     label var prolific_duration "Time taken (seconds, Prolific)"
 47.     label var prolific_approvals "Total approvals (Prolific)"
 48.     label var prolific_age "Age (Prolific)"
 49.     label var prolific_sex "Sex (Prolific)"
 50.     label var prolific_ethnicity "Ethnicity simplified (Prolific)"
 51.     label var prolific_country_birth "Country of birth (Prolific)"
 52.     label var prolific_country_residence "Country of residence (Prolific)"
 53.     label var prolific_nationality "Nationality (Prolific)"
 54.     label var prolific_language "Language (Prolific)"
 55.     label var prolific_student "Student status (Prolific)"
 56.     label var prolific_employment "Employment status (Prolific)"
 57. 
.     * Compress and save
.     compress
 58.     save "`outfile'", replace
 59. 
.     di "Saved: `outfile'"
 60.     di "Observations: " _N
 61. end

. 
. /*---------------------------------------------------------------------------
> ---
>     Clean each file
> -----------------------------------------------------------------------------
> -*/
. 
. * Prescreen (long string filename)
. clean_prolific ///
>     "raw_data/prolific_demographic_export_692494f77a877e57e000eb60" ///
>     "derived/prolific_demographics_prescreen.dta"

=== Cleaning: raw_data/prolific_demographic_export_692494f77a877e57e000eb60 ===
prolific_age: contains nonnumeric characters; replaced as int
(168 missing values generated)
prolific_duration already numeric; no replace
prolific_approvals already numeric; no replace
(1,795 real changes made)
(1,825 real changes made)
(1,795 missing values generated)
(1,825 missing values generated)
(1,825 missing values generated)
(1,825 missing values generated)
(1,825 missing values generated)
  variable study_id was float now int
  variable prolific_female was float now byte
  variable prolific_male was float now byte
  variable prolific_ethnicity_n was long now byte
  variable prolific_is_student was float now byte
  variable prolific_employed_ft was float now byte
  variable prolific_employed_pt was float now byte
  variable prolific_not_working was float now byte
  variable prolific_unemployed was float now byte
  (213,616 bytes saved)
(file derived/prolific_demographics_prescreen.dta not found)
file derived/prolific_demographics_prescreen.dta saved
Saved: derived/prolific_demographics_prescreen.dta
Observations: 8216

. 
. * Main
. clean_prolific ///
>     "raw_data/prolific_demographic_export_main" ///
>     "derived/prolific_demographics_main.dta"

=== Cleaning: raw_data/prolific_demographic_export_main ===
prolific_age: contains nonnumeric characters; replaced as byte
(68 missing values generated)
prolific_duration already numeric; no replace
prolific_approvals already numeric; no replace
(566 real changes made)
(574 real changes made)
(566 missing values generated)
(574 missing values generated)
(574 missing values generated)
(574 missing values generated)
(574 missing values generated)
  variable study_id was float now int
  variable prolific_female was float now byte
  variable prolific_male was float now byte
  variable prolific_ethnicity_n was long now byte
  variable prolific_is_student was float now byte
  variable prolific_employed_ft was float now byte
  variable prolific_employed_pt was float now byte
  variable prolific_not_working was float now byte
  variable prolific_unemployed was float now byte
  (71,552 bytes saved)
(file derived/prolific_demographics_main.dta not found)
file derived/prolific_demographics_main.dta saved
Saved: derived/prolific_demographics_main.dta
Observations: 2752

. 
. * Main morepay
. clean_prolific ///
>     "raw_data/prolific_demographic_export_main_morepay" ///
>     "derived/prolific_demographics_main_morepay.dta"

=== Cleaning: raw_data/prolific_demographic_export_main_morepay ===
prolific_age: contains nonnumeric characters; replaced as byte
(22 missing values generated)
prolific_duration already numeric; no replace
prolific_approvals already numeric; no replace
(176 real changes made)
(180 real changes made)
(176 missing values generated)
(180 missing values generated)
(180 missing values generated)
(180 missing values generated)
(180 missing values generated)
  variable study_id was float now int
  variable prolific_female was float now byte
  variable prolific_male was float now byte
  variable prolific_ethnicity_n was long now byte
  variable prolific_is_student was float now byte
  variable prolific_employed_ft was float now byte
  variable prolific_employed_pt was float now byte
  variable prolific_not_working was float now byte
  variable prolific_unemployed was float now byte
  (23,504 bytes saved)
(file derived/prolific_demographics_main_morepay.dta not found)
file derived/prolific_demographics_main_morepay.dta saved
Saved: derived/prolific_demographics_main_morepay.dta
Observations: 904

. 
. * Followup
. clean_prolific ///
>     "raw_data/prolific_demographic_export_followup" ///
>     "derived/prolific_demographics_followup.dta"

=== Cleaning: raw_data/prolific_demographic_export_followup ===
prolific_age: contains nonnumeric characters; replaced as byte
(70 missing values generated)
prolific_duration already numeric; no replace
prolific_approvals already numeric; no replace
(638 real changes made)
(643 real changes made)
(638 missing values generated)
(643 missing values generated)
(643 missing values generated)
(643 missing values generated)
(643 missing values generated)
  variable study_id was float now int
  variable prolific_female was float now byte
  variable prolific_male was float now byte
  variable prolific_ethnicity_n was long now byte
  variable prolific_is_student was float now byte
  variable prolific_employed_ft was float now byte
  variable prolific_employed_pt was float now byte
  variable prolific_not_working was float now byte
  variable prolific_unemployed was float now byte
  (82,992 bytes saved)
(file derived/prolific_demographics_followup.dta not found)
file derived/prolific_demographics_followup.dta saved
Saved: derived/prolific_demographics_followup.dta
Observations: 3192

. 
. /*---------------------------------------------------------------------------
> ---
>     Summary
> -----------------------------------------------------------------------------
> -*/
. 
. di ""


. di "=== All prolific demographic files cleaned ==="
=== All prolific demographic files cleaned ===

. 
. capture log close

. 
end of do-file
