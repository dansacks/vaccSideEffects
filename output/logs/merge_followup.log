
  ___  ____  ____  ____  ____ ®
 /__    /   ____/   /   ____/      StataNow 19.5
___/   /   /___/   /   /___/       SE—Standard Edition

 Statistics and Data Science       Copyright 1985-2025 StataCorp LLC
                                   StataCorp
                                   4905 Lakeway Drive
                                   College Station, Texas 77845 USA
                                   800-782-8272        https://www.stata.com
                                   979-696-4600        service@stata.com

Stata license: Unlimited-user network, expiring 23 Oct 2026
Serial number: 401909300710
  Licensed to: Daniel Sacks
               

Notes:
      1. Stata is running in batch mode.
      2. Unicode is supported; see help unicode_advice.
      3. Maximum number of variables is set to 5,000 but can be increased;
          see help set_maxvar.

. do /Users/sacks/Projects/VaccSideEffects/code/merge_followup.do 

. /*===========================================================================
> ===
>     Merge folloup data with combined prescreen and main data
>     Input:  data/followup_clean.dta
>             data/merged_main_pre.dta
>     Output: data/merged_all.dta
> 
>     Merges on prolific_pid. 
> 
>     Created by Dan + Claude Code
> =============================================================================
> =*/
. 
. clear all

. global scriptname "merge_followup"

. do "code/_config.do"

. /*===========================================================================
> ===
>     Project Configuration
> 
>     Set the project directory once here; all other scripts include this file.
> 
>     Usage: Include at the top of each do-file:
>         global scriptname "my_script"
>         do "code/_config.do"
> 
>     In batch mode (stata -e), logs to output/logs/{scriptname}.log
>     In interactive mode, no logging occurs.
> 
>     Created by Dan + Claude Code
> =============================================================================
> =*/
. 
. * Settings for both batch and interactive mode
. set more off

. set rmsg off

. 
. * Set project directory based on operating system
. * c(os) returns "Windows" on Windows, "Unix" or "MacOSX" on Mac
. local usr `c(username)'

. if "`c(os)'" == "Windows" {
.     global projdir "C:/Users/`usr'/Projects/VaccSideEffects"
. }

. else {
.     * macOS (Unix or MacOSX)
.     global projdir "/Users/`usr'/Projects/VaccSideEffects"
. }

. cd "$projdir"
/Users/sacks/Projects/VaccSideEffects

. 
. * Add local ado files to path (for plot_to_csv and other custom programs)
. adopath + "$projdir/code/include"
  [1]  (BASE)      "/Applications/StataNow/ado/base/"
  [2]  (SITE)      "/Applications/StataNow/ado/site/"
  [3]              "."
  [4]  (PERSONAL)  "/Users/sacks/Documents/Stata/ado/personal/"
  [5]  (PLUS)      "/Users/sacks/Library/Application Support/Stata/ado/plus/"
  [6]  (OLDPLACE)  "~/ado/"
  [7]              "/Users/sacks/Projects/VaccSideEffects/code/include"

. adopath + "$projdir/code/ado"
  [1]  (BASE)      "/Applications/StataNow/ado/base/"
  [2]  (SITE)      "/Applications/StataNow/ado/site/"
  [3]              "."
  [4]  (PERSONAL)  "/Users/sacks/Documents/Stata/ado/personal/"
  [5]  (PLUS)      "/Users/sacks/Library/Application Support/Stata/ado/plus/"
  [6]  (OLDPLACE)  "~/ado/"
  [7]              "/Users/sacks/Projects/VaccSideEffects/code/include"
  [8]              "/Users/sacks/Projects/VaccSideEffects/code/ado"

. 
. * Create output subdirectories if they don't exist
. capture mkdir "output"

. capture mkdir "output/logs"

. capture mkdir "output/tables"

. capture mkdir "output/docs"

. capture mkdir "output/figures"

. 
. /*---------------------------------------------------------------------------
> ---
>     Named Constants
> 
>     These replace magic numbers scattered throughout the codebase.
> -----------------------------------------------------------------------------
> -*/
. 
. * Attention check expected values (from survey design)
. global ATTN_CHECK_PRESCREEN = 1965

. global ATTN_CHECK_MAIN = 4419

. global ATTN_CHECK_FOLLOWUP = 1163

. 
. * Special code for unselected responses
. global UNSELECTED_VALUE  = -99

. 
. * Special code for "prefer not to say" responses (same as unselected)
. global PREF_NOT_SAY = -99

. 
. /*---------------------------------------------------------------------------
> ---
>     Conditional Logging
> -----------------------------------------------------------------------------
> -*/
. 
. * Only log in batch mode
. if "`c(mode)'" == "batch" & "$scriptname" != "" {
.     capture log close _all
.     log using "output/logs/$scriptname.log", replace text
-------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/sacks/Projects/VaccSideEffects/output/logs/merge_followup.l
> og
  log type:  text
 opened on:  27 Jan 2026, 13:08:52
.     di "=== Running in batch mode: $scriptname ==="
=== Running in batch mode: merge_followup ===
.     di "Log: output/logs/$scriptname.log"
Log: output/logs/merge_followup.log
.     di ""

. }

. 
end of do-file

. 
. use "derived/followup_clean.dta" if final_sample , clear

. rename attn_check attn_check_followup

. rename final_sample followup_final_sample

. drop is_preview

. 
. tempfile followup

. save `followup'
file /var/folders/_y/_xwy4y390t9bgphz7ts4mj540000gn/T//St89964.000001 saved
    as .dta format

. 
. use "derived/merged_main_pre", clear

. * Note: final_sample was renamed to main_final_sample in merge_prescreen_main
> .do
. assert main_final_sample 

. 
. 
. merge 1:1 prolific_pid using `followup', update assert(1 2 3) keep(1 3)
(label yesno already defined)

    Result                      Number of obs
    -----------------------------------------
    Not matched                           476
        from master                       476  (_merge==1)
        from using                          0  (_merge==2)

    Matched                             3,062
        not updated                     3,062  (_merge==3)
        missing updated                     0  (_merge==4)
        nonmissing conflict                 0  (_merge==5)
    -----------------------------------------

. 
. tab _merge

   Matching result from |
                  merge |      Freq.     Percent        Cum.
------------------------+-----------------------------------
        Master only (1) |        476       13.45       13.45
            Matched (3) |      3,062       86.55      100.00
------------------------+-----------------------------------
                  Total |      3,538      100.00

. gen in_followup = _merge == 3

. drop _merge

. label var in_followup "Observation in main and followup"

. 
. * Create followup_sample flag: in all three final samples and merged
. gen followup_sample = (main_sample==1 & in_followup==1 & followup_final_sampl
> e==1)

. label var followup_sample "In final sample for followup analysis (pre + main 
> + followup)"

. 
. count if followup_sample==1
  3,060

. di "Followup analysis sample: " r(N)
Followup analysis sample: 3060

. 
. save "derived/merged_all", replace 
file derived/merged_all.dta saved

. 
end of do-file
