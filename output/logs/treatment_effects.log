
  ___  ____  ____  ____  ____ ®
 /__    /   ____/   /   ____/      StataNow 19.5
___/   /   /___/   /   /___/       SE—Standard Edition

 Statistics and Data Science       Copyright 1985-2025 StataCorp LLC
                                   StataCorp
                                   4905 Lakeway Drive
                                   College Station, Texas 77845 USA
                                   800-782-8272        https://www.stata.com
                                   979-696-4600        service@stata.com

Stata license: Unlimited-user network, expiring 23 Oct 2026
Serial number: 401909300710
  Licensed to: Daniel Sacks
               

Notes:
      1. Stata is running in batch mode.
      2. Unicode is supported; see help unicode_advice.
      3. Maximum number of variables is set to 5,000 but can be increased;
          see help set_maxvar.

. do code/treatment_effects.do 

. /*===========================================================================
> ===
>     Treatment Effects Regressions
> 
>     Input:  derived/merged_all.dta
>     Output: output/tables/treatment_effects.tex
> 
>     Estimates treatment effects of information source on:
>     - post_trial: Post-trial side effect estimate
>     - delta: Posterior difference (vacc - novacc)
>     - main_maybe: Binary vaccination intention
>     - link_click: Any link clicked
>     - vacc_post: Got flu vaccine or already had it (followup)
> 
>     Requires: code/ado/regression_table.ado
> 
>     Created by Dan + Claude Code
> =============================================================================
> =*/
. 
. clear all

. global scriptname "treatment_effects"

. do "code/_config.do"

. /*===========================================================================
> ===
>     Project Configuration
> 
>     Set the project directory once here; all other scripts include this file.
> 
>     Usage: Include at the top of each do-file:
>         global scriptname "my_script"
>         do "code/_config.do"
> 
>     In batch mode (stata -e), logs to output/logs/{scriptname}.log
>     In interactive mode, no logging occurs.
> 
>     Created by Dan + Claude Code
> =============================================================================
> =*/
. 
. * Settings for both batch and interactive mode
. set more off

. set rmsg off

. 
. * Set project directory based on operating system
. * c(os) returns "Windows" on Windows, "Unix" or "MacOSX" on Mac
. local usr `c(username)'

. if "`c(os)'" == "Windows" {
.     global projdir "C:/Users/`usr'/Projects/VaccSideEffects"
. }

. else {
.     * macOS (Unix or MacOSX)
.     global projdir "/Users/`usr'/Projects/VaccSideEffects"
. }

. cd "$projdir"
/Users/sacks/Projects/VaccSideEffects

. 
. * Add local ado files to path (for plot_to_csv and other custom programs)
. adopath + "$projdir/code/include"
  [1]  (BASE)      "/Applications/StataNow/ado/base/"
  [2]  (SITE)      "/Applications/StataNow/ado/site/"
  [3]              "."
  [4]  (PERSONAL)  "/Users/sacks/Documents/Stata/ado/personal/"
  [5]  (PLUS)      "/Users/sacks/Library/Application Support/Stata/ado/plus/"
  [6]  (OLDPLACE)  "~/ado/"
  [7]              "/Users/sacks/Projects/VaccSideEffects/code/include"

. adopath + "$projdir/code/ado"
  [1]  (BASE)      "/Applications/StataNow/ado/base/"
  [2]  (SITE)      "/Applications/StataNow/ado/site/"
  [3]              "."
  [4]  (PERSONAL)  "/Users/sacks/Documents/Stata/ado/personal/"
  [5]  (PLUS)      "/Users/sacks/Library/Application Support/Stata/ado/plus/"
  [6]  (OLDPLACE)  "~/ado/"
  [7]              "/Users/sacks/Projects/VaccSideEffects/code/include"
  [8]              "/Users/sacks/Projects/VaccSideEffects/code/ado"

. 
. * Create output subdirectories if they don't exist
. capture mkdir "output"

. capture mkdir "output/logs"

. capture mkdir "output/tables"

. capture mkdir "output/docs"

. capture mkdir "output/figures"

. 
. /*---------------------------------------------------------------------------
> ---
>     Named Constants
> 
>     These replace magic numbers scattered throughout the codebase.
> -----------------------------------------------------------------------------
> -*/
. 
. * Attention check expected values (from survey design)
. global ATTN_CHECK_PRESCREEN = 1965

. global ATTN_CHECK_MAIN = 4419

. global ATTN_CHECK_FOLLOWUP = 1163

. 
. * Special code for unselected responses
. global UNSELECTED_VALUE  = -99

. 
. /*---------------------------------------------------------------------------
> ---
>     Conditional Logging
> -----------------------------------------------------------------------------
> -*/
. 
. * Only log in batch mode
. if "`c(mode)'" == "batch" & "$scriptname" != "" {
.     capture log close _all
.     log using "output/logs/$scriptname.log", replace text
-------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/sacks/Projects/VaccSideEffects/output/logs/treatment_effect
> s.log
  log type:  text
 opened on:  26 Jan 2026, 16:47:23
.     di "=== Running in batch mode: $scriptname ==="
=== Running in batch mode: treatment_effects ===
.     di "Log: output/logs/$scriptname.log"
Log: output/logs/treatment_effects.log
.     di ""

. }

. 
end of do-file

. 
. /*---------------------------------------------------------------------------
> ---
>     1. Define controls
> -----------------------------------------------------------------------------
> -*/
. 
. do "code/_set_controls.do"

. /*===========================================================================
> ===
>     Control Variables Definition
> 
>     Include this file in do-files that run regressions with control variables
> .
>     Sets globals: prior_beliefs, vacc_experience, demographics, controls
> =============================================================================
> =*/
. 
. * Prior beliefs from main survey
. global prior_beliefs "i.prior_self_placebo i.prior_self_vacc"

. 
. * Vaccine experiences from prescreen
. global vacc_experience "had_prior_covid_vacc had_prior_flu_vacc i.covid_vacc_
> reaction i.flu_vacc_reaction"

. 
. * Demographics from main survey
. global demographics "i.age i.gender i.education i.income i.race i.ethnicity i
> .polviews"

. 
. * All controls combined
. global controls "$prior_beliefs i.pre_vacc_intent $vacc_experience $demograph
> ics i.trust_govt cond_*"

. 
end of do-file

. 
. /*---------------------------------------------------------------------------
> ---
>     2. Load data and prepare variables
> -----------------------------------------------------------------------------
> -*/
. 
. use "derived/merged_all.dta", clear

. keep if main_sample==1
(4 observations deleted)

. 
. * Create link_click if not already present (max of link1-4)
. capture confirm variable link_click

. if _rc {
.     egen link_click = rowmax(link1_clicked link2_clicked link3_clicked link4_
> clicked)
.     label var link_click "Any link clicked"
. }

. 
. * Convert -99 (prefer not to say) to missing for categorical variables
. foreach var in age gender education income race ethnicity {
  2.     replace `var' = . if `var' == -99
  3. }
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)

. 
. * Create vaccination outcome (got vaccine or already had it)
. gen vacc_post = got_flu_vacc == 1 | flu_why_already == 1 if ~missing(got_flu_
> vacc)
(534 missing values generated)

. 
. * Label treatment indicators
. label var arm_industry "Industry"

. label var arm_academic "Academic"

. label var arm_personal "Personal"

. 
. /*---------------------------------------------------------------------------
> ---
>     3. Generate treatment effects table
> -----------------------------------------------------------------------------
> -*/
. 
. regression_table post_trial delta main_maybe link_click vacc_post, ///
>     keyvars(arm_industry arm_academic arm_personal) ///
>     controls($controls) saving(output/tables/treatment_effects.tex)

=== Regression: post_trial ===

=== Regression: delta ===

=== Regression: main_maybe ===

=== Regression: link_click ===

=== Regression: vacc_post ===

Regression Table
-------------------------------------------------------------------------------
                      post_trial       delta  main_maybe  link_click   vacc_pos
> t
-------------------------------------------------------------------------------
Industry                  -7.971      -3.303      -0.000      -0.002      -0.01
> 4
                        ( 0.853)    ( 1.022)    ( 0.012)    ( 0.006)    ( 0.013
> )
Academic                  -4.392      -2.857       0.031      -0.003       0.02
> 1
                        ( 0.874)    ( 1.010)    ( 0.013)    ( 0.006)    ( 0.015
> )
Personal                  -4.728       0.387       0.024      -0.002       0.01
> 8
                        ( 0.878)    ( 1.018)    ( 0.013)    ( 0.006)    ( 0.014
> )
-------------------------------------------------------------------------------
Control mean              20.193      15.410       0.069       0.015       0.08
> 3
N                          3,516       3,516       3,516       3,516       2,99
> 2
-------------------------------------------------------------------------------
Saved: output/tables/treatment_effects.tex
Saved: output/tables/treatment_effects.md

. 
. capture log close

. 
end of do-file
