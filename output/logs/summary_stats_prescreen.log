
  ___  ____  ____  ____  ____ ©
 /__    /   ____/   /   ____/      17.0
___/   /   /___/   /   /___/       MP—Parallel Edition

 Statistics and Data Science       Copyright 1985-2021 StataCorp LLC
                                   StataCorp
                                   4905 Lakeway Drive
                                   College Station, Texas 77845 USA
                                   800-STATA-PC        https://www.stata.com
                                   979-696-4600        stata@stata.com

Stata license: Single-user 4-core  perpetual
Serial number: 501709220187
  Licensed to: Dan Sacks
               Indiana University

Notes:
      1. Stata is running in batch mode.
      2. Unicode is supported; see help unicode_advice.
      3. More than 2 billion observations are allowed; see help obs_advice.
      4. Maximum number of variables is set to 5,000; see help set_maxvar.

. do C:/Users/sacks/Box/VaccSideEffects/code/summary_stats_prescreen.do 

. /*===========================================================================
> ===
>     Summary Statistics: Prescreen Data
> 
>     Input:  data/prescreen_clean.dta
>     Output:
>       - output/stats_continuous.csv (for Python codebook builder)
>       - output/stats_categorical.csv (for Python codebook builder)
>       - output/prescreen_summary_stats.txt (human-readable log)
> 
>     Produces summary statistics for valid observations (final_sample == 1):
>     - Continuous variables: mean, SD, percentiles
>     - Categorical variables: frequency distribution
> 
>     Created by Dan + Claude Code
> =============================================================================
> =*/
. 
. clear all

. global scriptname "summary_stats_prescreen"

. do "code/_config.do"

. /*===========================================================================
> ===
>     Project Configuration
> 
>     Set the project directory once here; all other scripts include this file.
> 
>     Usage: Include at the top of each do-file:
>         global scriptname "my_script"
>         do "code/_config.do"
> 
>     In batch mode (stata -e), logs to output/logs/{scriptname}.log
>     In interactive mode, no logging occurs.
> 
>     Created by Dan + Claude Code
> =============================================================================
> =*/
. 
. * Settings for both batch and interactive mode
. set more off

. set rmsg off

. 
. * Set project directory
. local usr `c(username)'

. global projdir "C:/Users/`usr'/Box/VaccSideEffects"

. cd "$projdir"
C:\Users\sacks\Box\VaccSideEffects

. 
. * Create output subdirectories if they don't exist
. capture mkdir "output"

. capture mkdir "output/logs"

. capture mkdir "output/tables"

. capture mkdir "output/docs"

. capture mkdir "output/figures"

. 
. * Conditional logging: only log in batch mode
. if "`c(mode)'" == "batch" & "$scriptname" != "" {
.     capture log close _all
.     log using "output/logs/$scriptname.log", replace text
-------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\sacks\Box\VaccSideEffects\output/logs/summary_stats_presc
> reen.log
  log type:  text
 opened on:  18 Jan 2026, 09:39:26
.     di "=== Running in batch mode: $scriptname ==="
=== Running in batch mode: summary_stats_prescreen ===
.     di "Log: output/logs/$scriptname.log"
Log: output/logs/summary_stats_prescreen.log
.     di ""

. }

. 
end of do-file

. 
. * Load cleaned data
. use "derived/prescreen_clean.dta", clear

. 
. * Keep only valid observations
. keep if final_sample == 1
(195 observations deleted)

. count
  8,003

. local n_valid = r(N) 

. 
. /*===========================================================================
> ===
>     EXPORT CONTINUOUS VARIABLE STATISTICS TO CSV
> =============================================================================
> =*/
. 
. file open contcsv using "output/tables/stats_continuous.csv", write replace

. file write contcsv "variable,n,mean,sd,min,p50,max" _n

. 
. * Duration (only continuous variable with meaningful stats in final sample)
. summarize duration_sec, detail

                  Survey duration (seconds)
-------------------------------------------------------------
      Percentiles      Smallest
 1%           74             10
 5%           96             11
10%          109             12       Obs               8,003
25%          138             12       Sum of wgt.       8,003

50%          188                      Mean           258.4858
                        Largest       Std. dev.      845.2238
75%          270           5900
90%          420          14816       Variance       714403.3
95%          579          45820       Skewness       54.95113
99%         1065          55342       Kurtosis       3321.453

. file write contcsv "duration_sec," (r(N)) "," (r(mean)) "," (r(sd)) "," (r(mi
> n)) "," (r(p50)) "," (r(max)) _n

. 
. file close contcsv

. 
. /*===========================================================================
> ===
>     EXPORT CATEGORICAL VARIABLE STATISTICS TO CSV
> =============================================================================
> =*/
. 
. file open catcsv using "output/tables/stats_categorical.csv", write replace

. file write catcsv "variable,value,n,pct" _n

. 
. * Helper program to write categorical stats
. capture program drop write_cat_stats

. program define write_cat_stats
  1.     args varname
  2. 
.     quietly levelsof `varname', local(levels)
  3.     quietly count if !mi(`varname')
  4.     local n_nonmiss = r(N)
  5. 
.     foreach val of local levels {
  6.         quietly count if `varname' == `val'
  7.         local n = r(N)
  8.         local pct = 100 * `n' / `n_nonmiss'
  9.         file write catcsv "`varname',`val'," (`n') "," (`pct') _n
 10.     }
 11. 
.     * Also write missing count if any
.     quietly count if mi(`varname')
 12.     if r(N) > 0 {
 13.         local n = r(N)
 14.         local pct = 100 * `n' / ($n_valid)
 15.         file write catcsv "`varname',.,`n',`pct'" _n
 16.     }
 17. end

. 
. * Store n_valid as global for use in program
. global n_valid = `n_valid'

. 
. 
. * loop over variables, writing out stats
. # delimit ;
delimiter now ;
. local vars 
>         flu_vacc_lastyear prior_vaccines vacc_intent had_prior_covid had_prio
> r_covid 
>         had_prior_flu covid_reaction flu_reaction
>         cond_none cond_asthma cond_diabetes cond_heart cond_lung cond_kidney 
> cond_rather_not_say
>         has_insurance trust_govt trust_govt_prior follow_doctor
>         info_source_main source_doctor source_sm source_podcasts source_cdc s
> ource_news source_none
>         info_doctor info_sm info_podcasts info_cdc info_news info_university
>         reliable_doctor reliable_sm reliable_podcasts reliable_cdc reliable_n
> ews reliable_university
>         incomplete pid_mismatch duplicate_pid
> ;

. # delimit cr  
delimiter now cr
.         
. foreach v of local vars {
  2.   write_cat_stats `v'
  3.         tab `v'
  4. }

    Got flu |
    vaccine |
  last year |      Freq.     Percent        Cum.
------------+-----------------------------------
      0. No |      3,455       43.53       43.53
     1. Yes |      4,482       56.47      100.00
------------+-----------------------------------
      Total |      7,937      100.00

     Prior vaccine |
           history |      Freq.     Percent        Cum.
-------------------+-----------------------------------
1. Neither vaccine |        872       10.99       10.99
       2. Flu only |        970       12.22       23.21
     3. COVID only |        991       12.49       35.69
  4. Both vaccines |      5,104       64.31      100.00
-------------------+-----------------------------------
             Total |      7,937      100.00

  Flu vaccine intent |
         this season |      Freq.     Percent        Cum.
---------------------+-----------------------------------
1. No, do not intend |      3,005       37.86       37.86
   2. May or may not |      1,520       19.15       57.01
    3. Intend to get |      1,141       14.38       71.39
      4. Already got |      2,271       28.61      100.00
---------------------+-----------------------------------
               Total |      7,937      100.00

  Had prior |
      COVID |
    vaccine |      Freq.     Percent        Cum.
------------+-----------------------------------
      0. No |      1,842       23.21       23.21
     1. Yes |      6,095       76.79      100.00
------------+-----------------------------------
      Total |      7,937      100.00

  Had prior |
      COVID |
    vaccine |      Freq.     Percent        Cum.
------------+-----------------------------------
      0. No |      1,842       23.21       23.21
     1. Yes |      6,095       76.79      100.00
------------+-----------------------------------
      Total |      7,937      100.00

  Had prior |
flu vaccine |      Freq.     Percent        Cum.
------------+-----------------------------------
      0. No |      1,863       23.47       23.47
     1. Yes |      6,074       76.53      100.00
------------+-----------------------------------
      Total |      7,937      100.00
variable covid_reaction not found
r(111);

end of do-file
r(111);
