
  ___  ____  ____  ____  ____ ®
 /__    /   ____/   /   ____/      StataNow 19.5
___/   /   /___/   /   /___/       SE—Standard Edition

 Statistics and Data Science       Copyright 1985-2025 StataCorp LLC
                                   StataCorp
                                   4905 Lakeway Drive
                                   College Station, Texas 77845 USA
                                   800-782-8272        https://www.stata.com
                                   979-696-4600        service@stata.com

Stata license: Unlimited-user network, expiring 23 Oct 2026
Serial number: 401909300710
  Licensed to: Daniel Sacks
               

Notes:
      1. Stata is running in batch mode.
      2. Unicode is supported; see help unicode_advice.
      3. Maximum number of variables is set to 5,000 but can be increased;
          see help set_maxvar.

. do /Users/sacks/Projects/VaccSideEffects/code/clean_followup.do 

. /*===========================================================================
> ===
>     Clean Follow-up Survey Data
> 
>     Input:  data/flu_vacc_se_followup_*.sav (SPSS export from Qualtrics)
>     Output: data/followup_clean.dta
> 
>     This do-file cleans the raw Qualtrics SPSS export from the follow-up surv
> ey.
>     Created by Dan + Claude Code
> =============================================================================
> =*/
. 
. clear all

. global scriptname "clean_followup"

. do "code/_config.do"

. /*===========================================================================
> ===
>     Project Configuration
> 
>     Set the project directory once here; all other scripts include this file.
> 
>     Usage: Include at the top of each do-file:
>         global scriptname "my_script"
>         do "code/_config.do"
> 
>     In batch mode (stata -e), logs to output/logs/{scriptname}.log
>     In interactive mode, no logging occurs.
> 
>     Created by Dan + Claude Code
> =============================================================================
> =*/
. 
. * Settings for both batch and interactive mode
. set more off

. set rmsg off

. 
. * Set project directory based on operating system
. * c(os) returns "Windows" on Windows, "Unix" or "MacOSX" on Mac
. local usr `c(username)'

. if "`c(os)'" == "Windows" {
.     global projdir "C:/Users/`usr'/Projects/VaccSideEffects"
. }

. else {
.     * macOS (Unix or MacOSX)
.     global projdir "/Users/`usr'/Projects/VaccSideEffects"
. }

. cd "$projdir"
/Users/sacks/Projects/VaccSideEffects

. 
. * Add local ado files to path (for plot_to_csv and other custom programs)
. adopath + "$projdir/code/include"
  [1]  (BASE)      "/Applications/StataNow/ado/base/"
  [2]  (SITE)      "/Applications/StataNow/ado/site/"
  [3]              "."
  [4]  (PERSONAL)  "/Users/sacks/Documents/Stata/ado/personal/"
  [5]  (PLUS)      "/Users/sacks/Library/Application Support/Stata/ado/plus/"
  [6]  (OLDPLACE)  "~/ado/"
  [7]              "/Users/sacks/Projects/VaccSideEffects/code/include"

. adopath + "$projdir/code/ado"
  [1]  (BASE)      "/Applications/StataNow/ado/base/"
  [2]  (SITE)      "/Applications/StataNow/ado/site/"
  [3]              "."
  [4]  (PERSONAL)  "/Users/sacks/Documents/Stata/ado/personal/"
  [5]  (PLUS)      "/Users/sacks/Library/Application Support/Stata/ado/plus/"
  [6]  (OLDPLACE)  "~/ado/"
  [7]              "/Users/sacks/Projects/VaccSideEffects/code/include"
  [8]              "/Users/sacks/Projects/VaccSideEffects/code/ado"

. 
. * Create output subdirectories if they don't exist
. capture mkdir "output"

. capture mkdir "output/logs"

. capture mkdir "output/tables"

. capture mkdir "output/docs"

. capture mkdir "output/figures"

. 
. /*---------------------------------------------------------------------------
> ---
>     Named Constants
> 
>     These replace magic numbers scattered throughout the codebase.
> -----------------------------------------------------------------------------
> -*/
. 
. * Attention check expected values (from survey design)
. global ATTN_CHECK_PRESCREEN = 1965

. global ATTN_CHECK_MAIN = 4419

. global ATTN_CHECK_FOLLOWUP = 1163

. 
. * Special code for unselected responses
. global UNSELECTED_VALUE  = -99

. 
. /*---------------------------------------------------------------------------
> ---
>     Conditional Logging
> -----------------------------------------------------------------------------
> -*/
. 
. * Only log in batch mode
. if "`c(mode)'" == "batch" & "$scriptname" != "" {
.     capture log close _all
.     log using "output/logs/$scriptname.log", replace text
-------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/sacks/Projects/VaccSideEffects/output/logs/clean_followup.l
> og
  log type:  text
 opened on:  26 Jan 2026, 16:47:12
.     di "=== Running in batch mode: $scriptname ==="
=== Running in batch mode: clean_followup ===
.     di "Log: output/logs/$scriptname.log"
Log: output/logs/clean_followup.log
.     di ""

. }

. 
end of do-file

. 
. /*---------------------------------------------------------------------------
> ---
>     1. Load raw SPSS data
> -----------------------------------------------------------------------------
> -*/
. 
. import spss using "raw_data/flu_vacc_se_followup_January+9,+2026_19.43.sav", 
> clear
(76 vars, 3,211 obs)

. 
. * Verify we have data
. assert _N > 0

. di "Loaded " _N " observations"
Loaded 3211 observations

. 
. /*---------------------------------------------------------------------------
> ---
>     2. Drop unused metadata variables
> -----------------------------------------------------------------------------
> -*/
. drop RecipientLastName RecipientFirstName RecipientEmail ExternalReference

. 
. /*---------------------------------------------------------------------------
> ---
>     3. Rename variables to clean names
> -----------------------------------------------------------------------------
> -*/
. 
. * Standard Qualtrics metadata renames
. do "code/include/_rename_qualtrics_metadata.do"

. /*===========================================================================
> ===
>     Rename Standard Qualtrics Metadata Variables
> 
>     This include file standardizes the renaming of Qualtrics metadata variabl
> es
>     that are common across all survey exports (prescreen, main, followup).
> 
>     Must be called after import spss and before variable-specific cleaning.
> 
>     Usage: do "code/include/_rename_qualtrics_metadata.do"
> =============================================================================
> =*/
. 
. * Rename Qualtrics metadata to clean names
. rename StartDate start_date

. rename EndDate end_date

. rename Duration__in_seconds_ duration_sec

. rename Finished _finished

. rename ResponseId response_id

. rename IPAddress _ipaddress

. rename LocationLatitude _lat

. rename LocationLongitude _long

. rename Status _status

. rename RecordedDate _recordeddate

. rename DistributionChannel _distchannel

. rename UserLanguage _userlang

. 
. * Rename Progress if it exists (some surveys already have lowercase)
. capture rename Progress progress

. 
end of do-file

. 
. * Rename followup-specific variables from SPSS names
. rename Survey_Information consent

. rename prolific_pid prolific_id_entered

. rename Attention attn_check

. rename _v1 prolific_pid

. 
. * Pharmacy factors and shopping
. rename factors pharmacy_factor

. rename Price_compare_ price_compare

. rename Coupons_deals_ use_coupons

. 
. * Vaccination status
. rename GLP1_ got_glp1

. rename Flu_vax_ got_flu_vacc

. rename COVID_Vax_ got_covid_vacc

. 
. * Recall questions
. rename recall recall_study

. rename Placebo___ guess_placebo

. rename Q32 guess_vaccine

. rename Manufacturer_* recall_manufacturer

. rename University_trial_* recall_university

. rename Gavi_trial_ recall_gavi

. rename Trustworthy_ found_trustworthy

. rename Q1 comments

. 
. * Where medicine dummies (already split in SPSS)
. * Use wildcards because SPSS names are truncated
. rename Where_Medicin*1 med_pharmacy_chain

. rename Where_Medicin*2 med_grocery

. rename Where_Medicin*3 med_independent

. rename Where_Medicin*4 med_mail_order

. rename Where_Medicin*5 med_online

. rename Where_Medicin*6 med_provider

. rename Where_Medicin*7 med_other

. rename Where_Medicin*8 med_none

. 
. * Flu why not dummies (note: "fly" typo in SPSS)
. rename fly_why_1 flu_why_already

. rename fly_why_2 flu_why_side_effects

. rename fly_why_3 flu_why_bad_flu

. rename fly_why_4 flu_why_needles

. rename fly_why_5 flu_why_time

. rename fly_why_6 flu_why_location

. rename fly_why_7 flu_why_cost

. rename fly_why_8 flu_why_none

. 
. * Drop display order variables and unused sub-selects
. capture drop fly_why_DO_*

. capture drop Where_online*

. capture drop Where_grocery*

. capture drop What_chain*

. 
. /*---------------------------------------------------------------------------
> ---
>     4. Create preview flag from Status
> -----------------------------------------------------------------------------
> -*/
. 
. * Status: 0 = IP Address (real), 1 = Survey Preview
. gen is_preview = (_status == 1)

. 
. /*---------------------------------------------------------------------------
> ---
>     5. Define value labels
> -----------------------------------------------------------------------------
> -*/
. 
. do "code/include/_define_value_labels.do"

. /*===========================================================================
> ===
>     Define Common Value Labels
> 
>     This include file defines all value labels used across survey cleaning fi
> les.
>     Centralizes label definitions to ensure consistency and reduce duplicatio
> n.
> 
>     Must be called before variable recoding/labeling.
> 
>     Usage: do "code/include/_define_value_labels.do"
> =============================================================================
> =*/
. 
. * Boolean (Yes/No)
. label define yesno 0 "0. No" 1 "1. Yes", replace

. 
. * Insurance (Yes/No/Not sure) - prescreen only
. label define insurance_lbl -1 "-1. Not sure" 0 "0. No" 1 "1. Yes", replace

. 
. * Likert agreement scale (1-5)
. label define agree5 ///
>     1 "1. Strongly disagree" ///
>     2 "2. Somewhat disagree" ///
>     3 "3. Neither agree nor disagree" ///
>     4 "4. Somewhat agree" ///
>     5 "5. Strongly agree", replace

. 
. * Frequency scale (1-4)
. label define freq4 ///
>     1 "1. Never" ///
>     2 "2. Rarely" ///
>     3 "3. Sometimes" ///
>     4 "4. Often", replace

. 
. * Frequency scale with "no doctor" option
. label define freq4_nodoc ///
>     -1 "-1. No doctor" ///
>     1 "1. Never" ///
>     2 "2. Rarely" ///
>     3 "3. Sometimes" ///
>     4 "4. Often", replace

. 
. * Reliability scale (1-3)
. label define reliable3 ///
>     1 "1. Not reliable" ///
>     2 "2. Somewhat reliable" ///
>     3 "3. Yes, reliable", replace

. 
. * Flu vaccine last year - prescreen
. label define fluvax_lastyear_lbl 0 "0. No" 1 "1. Yes", replace

. 
. * Prior vaccines - prescreen
. label define prior_vax_lbl ///
>     1 "1. Neither vaccine" ///
>     2 "2. Flu only" ///
>     3 "3. COVID only" ///
>     4 "4. Both vaccines", replace

. 
. * Flu vaccine intent - prescreen
. label define flu_intent_lbl ///
>     1 "1. No, do not intend" ///
>     2 "2. May or may not" ///
>     3 "3. Intend to get" ///
>     4 "4. Already got", replace

. 
. * Vaccine reaction - prescreen
. label define reaction_lbl ///
>     0 "0. No prior vaccine" ///
>     1 "1. None/don't remember" ///
>     2 "2. Mild (not severe)" ///
>     3 "3. Severe", replace

. 
. * Main info source - prescreen
. label define source_main_lbl ///
>     1 "1. Doctor" ///
>     2 "2. Social media" ///
>     3 "3. Podcasts" ///
>     4 "4. CDC" ///
>     5 "5. News organizations" ///
>     6 "6. None of the above", replace

. 
. * Treatment arm - main
. label define arm_lbl ///
>     0 "0. Control" ///
>     1 "1. Industry" ///
>     2 "2. Academic" ///
>     3 "3. Personal", replace

. 
. * Prior beliefs (7-point) - main
. label define prior7_lbl ///
>     1 "1. Would definitely not" ///
>     2 "2. Very unlikely" ///
>     3 "3. Somewhat unlikely" ///
>     4 "4. Neither likely nor unlikely" ///
>     5 "5. Somewhat likely" ///
>     6 "6. Very likely" ///
>     7 "7. Would definitely", replace

. 
. * Trust/relevance (0-10) - main
. label define scale10_lbl ///
>     0 "0" 1 "1" 2 "2" 3 "3" 4 "4" 5 "5" 6 "6" 7 "7" 8 "8" 9 "9" 10 "10", repl
> ace

. 
. * Vaccination intentions - main
. label define vacc_intent_lbl ///
>     1 "1. No, do not intend" ///
>     2 "2. May or may not" ///
>     3 "3. Intend to get" ///
>     4 "4. Already got" ///
>     $PREF_NOT_SAY "$PREF_NOT_SAY. Prefer not to say", replace
invalid syntax
r(198);

end of do-file
r(198);

end of do-file
r(198);
