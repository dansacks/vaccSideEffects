
  ___  ____  ____  ____  ____ ®
 /__    /   ____/   /   ____/      StataNow 19.5
___/   /   /___/   /   /___/       SE—Standard Edition

 Statistics and Data Science       Copyright 1985-2025 StataCorp LLC
                                   StataCorp
                                   4905 Lakeway Drive
                                   College Station, Texas 77845 USA
                                   800-782-8272        https://www.stata.com
                                   979-696-4600        service@stata.com

Stata license: Unlimited-user network, expiring 23 Oct 2026
Serial number: 401909300710
  Licensed to: Daniel Sacks
               

Notes:
      1. Stata is running in batch mode.
      2. Unicode is supported; see help unicode_advice.
      3. Maximum number of variables is set to 5,000 but can be increased;
          see help set_maxvar.

. do /Users/sacks/Projects/VaccSideEffects/code/explore_persistence.do 

. /*===========================================================================
> ===
>     Persistence of Information Effects
> 
>     Input:  derived/merged_all.dta
>     Output: output/tables/persistence_attrition.tex
>             output/tables/persistence_recall.tex
>             output/tables/persistence_adverse.tex
> 
>     Goal: Provide evidence on persistence of information, specifically, means
>           and treatment effects for:
>           - Differential attrition
>           - Recall of study participation and info provision details
>           - Clinical trial adverse event rates
> 
>     Requires: code/ado/regression_table.ado
> 
>     Created by Dan + Claude Code
> =============================================================================
> =*/
. 
. clear all

. global scriptname "explore_persistence"

. do "code/_config.do"

. /*===========================================================================
> ===
>     Project Configuration
> 
>     Set the project directory once here; all other scripts include this file.
> 
>     Usage: Include at the top of each do-file:
>         global scriptname "my_script"
>         do "code/_config.do"
> 
>     In batch mode (stata -e), logs to output/logs/{scriptname}.log
>     In interactive mode, no logging occurs.
> 
>     Created by Dan + Claude Code
> =============================================================================
> =*/
. 
. * Settings for both batch and interactive mode
. set more off

. set rmsg off

. 
. * Set project directory based on operating system
. * c(os) returns "Windows" on Windows, "Unix" or "MacOSX" on Mac
. local usr `c(username)'

. if "`c(os)'" == "Windows" {
.     global projdir "C:/Users/`usr'/Box/VaccSideEffects"
. }

. else {
.     * macOS (Unix or MacOSX)
.     global projdir "/Users/`usr'/Projects/VaccSideEffects"
. }

. cd "$projdir"
/Users/sacks/Projects/VaccSideEffects

. 
. * Add local ado files to path (for plot_to_csv and other custom programs)
. adopath + "$projdir/code/include"
  [1]  (BASE)      "/Applications/StataNow/ado/base/"
  [2]  (SITE)      "/Applications/StataNow/ado/site/"
  [3]              "."
  [4]  (PERSONAL)  "/Users/sacks/Documents/Stata/ado/personal/"
  [5]  (PLUS)      "/Users/sacks/Library/Application Support/Stata/ado/plus/"
  [6]  (OLDPLACE)  "~/ado/"
  [7]              "/Users/sacks/Projects/VaccSideEffects/code/include"

. adopath + "$projdir/code/ado"
  [1]  (BASE)      "/Applications/StataNow/ado/base/"
  [2]  (SITE)      "/Applications/StataNow/ado/site/"
  [3]              "."
  [4]  (PERSONAL)  "/Users/sacks/Documents/Stata/ado/personal/"
  [5]  (PLUS)      "/Users/sacks/Library/Application Support/Stata/ado/plus/"
  [6]  (OLDPLACE)  "~/ado/"
  [7]              "/Users/sacks/Projects/VaccSideEffects/code/include"
  [8]              "/Users/sacks/Projects/VaccSideEffects/code/ado"

. 
. * Create output subdirectories if they don't exist
. capture mkdir "output"

. capture mkdir "output/logs"

. capture mkdir "output/tables"

. capture mkdir "output/docs"

. capture mkdir "output/figures"

. 
. /*---------------------------------------------------------------------------
> ---
>     Named Constants
> 
>     These replace magic numbers scattered throughout the codebase.
> -----------------------------------------------------------------------------
> -*/
. 
. * Attention check expected values (from survey design)
. global ATTN_CHECK_PRESCREEN = 1965

. global ATTN_CHECK_MAIN = 4419

. global ATTN_CHECK_FOLLOWUP = 1163

. 
. * Special code for "Prefer not to say" responses
. global PREF_NOT_SAY = -99

. 
. /*---------------------------------------------------------------------------
> ---
>     Conditional Logging
> -----------------------------------------------------------------------------
> -*/
. 
. * Only log in batch mode
. if "`c(mode)'" == "batch" & "$scriptname" != "" {
.     capture log close _all
.     log using "output/logs/$scriptname.log", replace text
-------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/sacks/Projects/VaccSideEffects/output/logs/explore_persiste
> nce.log
  log type:  text
 opened on:  25 Jan 2026, 11:38:55
.     di "=== Running in batch mode: $scriptname ==="
=== Running in batch mode: explore_persistence ===
.     di "Log: output/logs/$scriptname.log"
Log: output/logs/explore_persistence.log
.     di ""

. }

. 
end of do-file

. 
. /*---------------------------------------------------------------------------
> ---
>     1. Define controls
> -----------------------------------------------------------------------------
> -*/
. 
. do "code/_set_controls.do"

. /*===========================================================================
> ===
>     Control Variables Definition
> 
>     Include this file in do-files that run regressions with control variables
> .
>     Sets globals: prior_beliefs, vacc_experience, demographics, controls
> =============================================================================
> =*/
. 
. * Prior beliefs from main survey
. global prior_beliefs "i.prior_self_placebo i.prior_self_vacc"

. 
. * Vaccine experiences from prescreen
. global vacc_experience "had_prior_covid_vacc had_prior_flu_vacc i.covid_vacc_
> reaction i.flu_vacc_reaction"

. 
. * Demographics from main survey
. global demographics "i.age i.gender i.education i.income i.race i.ethnicity i
> .polviews"

. 
. * All controls combined
. global controls "$prior_beliefs i.pre_vacc_intent $vacc_experience $demograph
> ics i.trust_govt cond_*"

. 
end of do-file

. 
. /*---------------------------------------------------------------------------
> ---
>     2. Load data and prepare variables
> -----------------------------------------------------------------------------
> -*/
. 
. use "derived/merged_all.dta", clear

. 
. * Sample indicators
. gen se_sample = guess_vaccine ~= -99 & guess_placebo ~= -99 & ///
>         in_followup & ~missing(guess_vaccine) & ~missing(guess_placebo)

. 
. egen recall_miss = rowmiss(recall_gavi recall_manufacturer recall_university)

. gen invalid_miss = in_followup & inlist(recall_study, 1, 3) & recall_miss

. gen recall_sample = in_followup & ~invalid_miss

. 
. * Recall outcome variables
. gen yes_recall_study = 1.recall_study
(525 missing values generated)

. gen yes_recall_manu = 1.recall_manufacturer
(1,014 missing values generated)

. gen yes_recall_uni = 1.recall_university
(1,014 missing values generated)

. gen yes_recall_gavi = 1.recall_gavi
(1,014 missing values generated)

. 
. * Adverse event rate guess
. gen guess_delta = guess_vaccine - guess_placebo
(538 missing values generated)

. 
. * Label treatment indicators
. label var arm_industry "Industry"

. label var arm_academic "Academic"

. label var arm_personal "Personal"

. 
. /*---------------------------------------------------------------------------
> ---
>     3. Attrition table
> -----------------------------------------------------------------------------
> -*/
. 
. regression_table in_followup recall_sample se_sample, ///
>     keyvars(arm_industry arm_academic arm_personal) ///
>     controls($controls) saving(output/tables/persistence_attrition.tex)

=== Regression: in_followup ===

=== Regression: recall_sample ===

=== Regression: se_sample ===

Regression Table
-------------------------------------------------------------------------------
                      in_follo~p  recall_s~e   se_sample
-------------------------------------------------------------------------------
Industry                   0.018       0.020       0.028
                        ( 0.016)    ( 0.016)    ( 0.017)
Academic                   0.007       0.008       0.008
                        ( 0.017)    ( 0.017)    ( 0.018)
Personal                   0.002       0.003       0.007
                        ( 0.017)    ( 0.017)    ( 0.017)
-------------------------------------------------------------------------------
Control mean               0.858       0.854       0.835
N                          3,516       3,516       3,516
-------------------------------------------------------------------------------
Saved: output/tables/persistence_attrition.tex

. 
. /*---------------------------------------------------------------------------
> ---
>     4. Recall table
> -----------------------------------------------------------------------------
> -*/
. 
. regression_table yes_recall_study yes_recall_manu yes_recall_uni yes_recall_g
> avi ///
>     if recall_sample, ///
>     keyvars(arm_industry arm_academic arm_personal) ///
>     controls($controls) saving(output/tables/persistence_recall.tex)

=== Regression: yes_recall_study ===

=== Regression: yes_recall_manu ===

=== Regression: yes_recall_uni ===

=== Regression: yes_recall_gavi ===

Regression Table
-------------------------------------------------------------------------------
                      yes_reca~y  yes_reca~u  yes_rec~ni  yes_rec~vi
-------------------------------------------------------------------------------
Industry                  -0.008       0.043       0.023      -0.013
                        ( 0.022)    ( 0.027)    ( 0.028)    ( 0.018)
Academic                   0.018       0.072       0.072       0.003
                        ( 0.023)    ( 0.028)    ( 0.028)    ( 0.018)
Personal                   0.017       0.048       0.050      -0.002
                        ( 0.022)    ( 0.027)    ( 0.028)    ( 0.018)
-------------------------------------------------------------------------------
Control mean               0.247       0.349       0.480       0.109
N                          2,995       2,515       2,515       2,515
-------------------------------------------------------------------------------
Saved: output/tables/persistence_recall.tex

. 
. /*---------------------------------------------------------------------------
> ---
>     5. Adverse event rates table
> -----------------------------------------------------------------------------
> -*/
. 
. regression_table guess_placebo placebo_correct guess_vaccine vaccine_correct 
> guess_delta ///
>     if se_sample, ///
>     keyvars(arm_industry arm_academic arm_personal) ///
>     controls($controls) saving(output/tables/persistence_adverse.tex)

=== Regression: guess_placebo ===

=== Regression: placebo_correct ===

=== Regression: guess_vaccine ===

=== Regression: vaccine_correct ===

=== Regression: guess_delta ===

Regression Table
-------------------------------------------------------------------------------
                      guess_pl~o  placebo_~t  guess_va~e  vaccine_~t  guess_de~
> a
-------------------------------------------------------------------------------
Industry                  -0.052       0.001      -2.698       0.002      -2.64
> 6
                        ( 0.848)    ( 0.022)    ( 0.812)    ( 0.017)    ( 0.956
> )
Academic                   0.795       0.005      -0.716       0.002      -1.51
> 1
                        ( 0.873)    ( 0.022)    ( 0.880)    ( 0.017)    ( 0.987
> )
Personal                   1.019      -0.020      -1.308       0.035      -2.32
> 7
                        ( 0.864)    ( 0.021)    ( 0.860)    ( 0.018)    ( 1.006
> )
-------------------------------------------------------------------------------
Control mean              15.545       0.226      15.221       0.115      -0.32
> 3
N                          2,988       2,988       2,988       2,988       2,98
> 8
-------------------------------------------------------------------------------
Saved: output/tables/persistence_adverse.tex

. 
. capture log close

. 
end of do-file
